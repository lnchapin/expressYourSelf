<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Results</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootswatch/4.0.0/flatly/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
  </head>
  <body>
    <h1>What are the stats like?</h1>

    <h3>Feelings</h3>
    <canvas id="myChartFeelings"></canvas>

    <h3>Category</h3>
    <canvas id="myChartCategory"></canvas>

    <script type="text/javascript">
      var feelingsCount={};
      var categoryCount={};

      var feelingsValue;
      var feelingsLabel;
      var categoryValue;
      var categoryLabel;

      $.get("/api/responses")
        .then(data=>{
          for(var i = 0; i < data.length; i++){
            if(feelingsCount.hasOwnProperty(data[i].feeling)){
              feelingsCount[`${data[i].feeling}`]+=1
            } else {
              feelingsCount[`${data[i].feeling}`] = 1
            }
            if(categoryCount.hasOwnProperty(data[i].category)){
              categoryCount[`${data[i].category}`]+=1
            }else{
              categoryCount[`${data[i].category}`]=1
            }
          }
          feelingsValues=Object.values(feelingsCount)
          feelingsLabel=Object.keys(feelingsCount)
          categoryValues=Object.values(categoryCount)
          categoryLabel=Object.keys(categoryCount)
          console.log(feelingsLabel)
          console.log(categoryLabel)
          console.log(feelingsValues)
          console.log(categoryValues)



          var ctxFeelings = document.getElementById('myChartFeelings').getContext('2d');
          var chart = new Chart(ctxFeelings, {
              // The type of chart we want to create
              type: 'pie',

              // The data for our dataset
              data: {
                  labels: feelingsLabel,
                  datasets: [{
                      label: 'My First dataset',
                      backgroundColor: 'rgb(255, 99, 132)',
                      borderColor: 'rgb(255, 99, 132)',
                      data: feelingsValues
                  }]
              },

              // Configuration options go here
              options: {}
          });




        })


    </script>
  </body>
</html>
